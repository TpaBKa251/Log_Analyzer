# Анализатор логов

## Описание

Данная программа анализирует логи формата NGINX из файлов и URL, 
затем выводит результат анализа в виде текстового отчета в файл или консоль.

**Схема NGINX-логов:**

    '$remote_addr - $remote_user [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent"'

Программа выполняет следующие задачи (состав отчета):

* Подсчитывает общее количество запросов;
* Определяет наиболее часто запрашиваемые ресурсы (ТОП-3);
* Определяет наиболее часто встречающиеся коды ответа (ТОП-3);
* Рассчитывает средний размер ответа сервера;
* Рассчитывает 95% перцентиль размера ответа сервера;
* Рассчитывает процентное соотношение 200-х, 400-х и 500-х кодов ответов сервера;
* Подсчитывает количество уникальных пользователей.

## Параметры запуска

### Обязательные параметры

- `--path`, `-p`  
  **Описание**: Путь до файла, шаблон для локальных фалов или URL.  
  **Пример**: `--path /path/to/logfile.log`

### Необязательные параметры

- `--file`, `-fe`  
  **Описание**: Включает вывод в файл.  
  **Значение по умолчанию**: `false`  
  **Пример**: `--file` (если этот флаг указан, вывод будет записан в файл).

- `--out`, `-o`  
  **Описание**: Путь до выходного файла.  
  **Значение по умолчанию**: `analyzed-logs`  
  **Пример**: `--out /path/to/output.log`

- `--from`, `-f`  
  **Описание**: Стартовые дата и время в формате ISO8601.  
  **Пример**: `--from 2023-01-01T00:00:00`

- `--to`, `-t`  
  **Описание**: Конечные дата и время в формате ISO8601.  
  **Пример**: `--to 2023-01-31T23:59:59`

- `--format`, `-ft`  
  **Описание**: Формат вывода (например, `markdown`).  
  **Значение по умолчанию**: `text`  
  **Пример**: `--format markdown`

- `--filter-field`, `-ff`  
  **Описание**: Поле для фильтрации.  
  **Значение по умолчанию**: `""` (пустая строка, без фильтрации)
  **Пример**: `--filter-field status`

- `--filter-value`, `-fv`  
  **Описание**: Значение поля для фильтрации.  
  **Пример**: `--filter-value 404`

### Особенности

- Вы можете использовать шаблоны для пути до файлов, например: `path/**/file.log`, `path/**`, `path/*.txt`;
- Вы можете использовать шаблоны для фильтрации, например: `GET*`, `*T08:05*`;
- В качестве выходного файла необязательно указывать существующий файл, программа сможет создать его, в том числе директории;
- В качестве выходного файла можно указать директорию, например: `path/to/directiry/`. В ней создастся выходной в файл с названием по умолчанию;
- Если вы хотите получить результат в файл, который уже существует,
то он должен быть в том же формате (с тем же расширением), что и формат вывода отчета, иначе создастся новый файл;
- При указывании выходного файла через `--out`, вывод автоматически произойдет в файл, даже если не указан параметр `--file`;
- При указывании выходного файла через `--out` с расширением,
вывод автоматически произойдет в формате файла, даже если указан параметр `--format` с другим форматом или он не указан вовсе;
- Выходной файл по умолчанию создается в директории, где запускается приложение;
- При указании параметров `--from` и `-to` в виде даты без времени,
автоматически возьмется начало дня (00:00:00) и конец дня (23:59:59) для соответствующих параметров;

### Ограничения

Есть следующие ограничения для некоторых параметров:

- Параметр `--format` может быть только `markdown`, `adoc` или `text`
- При указании `--filter-field`, также нужно указать `--filter-value` и наоборот.
- В параметр `-filer-field` можно ввести только следующие аргументы:
`ip`, `user`, `time`, `request`, `status`, `bytes`, `referer`, `agent`, `method`, `endpoint`, `version`

## Запуск

Приложение можно запустить следующими способами:
- Запуск из IDE - запустите Main класс с настроенными аргументами
- Запуск через JAR-файл. Для этого выполните следующую команду в кореневой папке проекта:

  Для UNIX:
    ```shell
    ./mvnw clean package
    ```
  Для Windows:
    ```shell
    cmd.mvnw clean package
    ```
  Из модального окна IDEA
    ```shell
    mvn clean package
    ```

### Примеры запуска

```shell
java -jar log-analyzer-1.0.0.jar --path /path/to/logfile.log
```
```shell
java -jar log-analyzer-1.0.0.jar --path /path/to/logfile.log --out /path/to/output.log
```
```shell
java -jar log-analyzer-1.0.0.jar --path /path/to/*.log --from 2024-01-01 --to 2024-01-31
```
```shell
java -jar log-analyzer-1.0.0.jar --path /path/to/logfile.log --file --format adoc
```
```shell
java -jar log-analyzer-1.0.0.jar --path /path/**/logfile.log --filter-field status --filter-value 404
```
```shell
java -jar log-analyzer-1.0.0.jar -p /path/to/logfile.log  -o /path/to/output.log -f 2024-01-01T10:00:08 -t 2023-01-31T16:47:18 -ft markdown -ff request -fv */downloads/product_1*
```

## Вывод

Вывод происходит в кодировке UTF-8 (и в консоль, и в файл)

## Пример отчета

## Основная статистика
### Общая информация
|        Метрика        |                                                                      Значение |
|:---------------------:|------------------------------------------------------------------------------:|
|       Файл(-ы)        | `/src/main/resources/logs/2024_08/logs.txt`<br>`/src/main/resources/logs.txt` |
|    Начальная дата     |                                                                             - |
|     Конечная дата     |                                                                             - |
|  Поле для фильтрации  |                                                                          time |
|     Значение поля     |                                                                    2015-05-17 |
|  Количество запросов  |                                                                          5898 |
| Средний размер ответа |                                                                        67318b |
|  95p размера ответа   |                                                                          341b |
### Часто запрашиваемые ресурсы (ТОП-3)
|         Ресурс         | Количество |
|:----------------------:|-----------:|
| `/downloads/product_2` |       3579 |
| `/downloads/product_1` |       2316 |
| `/downloads/product_3` |          3 |

### Часто встречающиеся коды ответа (ТОП-3)
| Код |     Имя      | Количество |
|:---:|:------------:|-----------:|
| 404 |  Not Found   |       4059 |
| 304 | Not Modified |       1578 |
| 200 |      OK      |        222 |
## Дополнительная статистика
### Проценты кодов (200, 400 и 500)
| Тип кода | Процентное соотношение |
|:--------:|-----------------------:|
|   400    |                    69% |
|   500    |                     0% |
|   200    |                     3% |
### Количество уникальных пользователей: 118




